{% load custom_filters %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Flux des utilisateurs suivis</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f8f8f8; padding: 20px; }
        .card { background: #fff; border: 1px solid #ccc; margin-bottom: 20px; padding: 15px; border-radius: 8px; }
        .response { margin-left: 20px; padding: 5px 0; }
        .form-block { margin-top: 10px; }
    </style>
</head>
<body>

<h1 style="color: green;">‚úÖ Flux charg√©</h1>

{% if items %}
    {% for item in items %}
        <div class="card">
            <p><strong>Type :</strong> {{ item|classname }}</p>

            {% if item|classname == "Review" %}
                <h3>üìù Critique par {{ item.user.username }}</h3>
                {% if item.title %}
                    <p><strong>Titre :</strong> {{ item.title }}</p>
                {% endif %}
                <p><strong>Note :</strong> {{ item.rating }}/5</p>
                <p>{{ item.content }}</p>
                <small>Post√© le {{ item.created_at|date:"M d, Y, H:i" }}</small>


                <h4>üí¨ R√©ponses :</h4>
                {% for response in item.responses.all %}
                    <div class="response">
                        <strong>{{ response.responder.username }}</strong> : {{ response.content }}
                    </div>
                {% empty %}
                    <p>Aucune r√©ponse pour cette critique.</p>
                {% endfor %}

                {% if user.is_authenticated %}
                    <div class="form-block">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="review_id" value="{{ item.id }}">
                            {{ form.as_p }}
                            <button type="submit">R√©pondre</button>
                        </form>
                    </div>
                {% else %}
                    <p><a href="{% url 'login' %}">Connectez-vous pour r√©pondre</a></p>
                {% endif %}

            {% elif item|classname == "Ticket" %}
                <h3>üéüÔ∏è Ticket cr√©√© par {{ item.user.username }}</h3>
                <p><strong>Titre :</strong> {{ item.title }}</p>
                <p>{{ item.description }}</p>
                <small>Cr√©√© le {{ item.created_at|date:"M d, Y, H:i" }}</small>


            {% else %}
                <p>Type non reconnu.</p>
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <p>Aucun √©l√©ment dans le flux.</p>
{% endif %}

</body>
</html>
